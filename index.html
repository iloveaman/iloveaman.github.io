<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>扫码登陆 by iloveaman</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">扫码登陆</h1>
      <h2 class="project-tagline">手机扫描其他设备上二维码实现登陆</h2>
    </section>

    <section class="main-content">
      <h1>
<a id="电视端扫码登陆" class="anchor" href="#%E7%94%B5%E8%A7%86%E7%AB%AF%E6%89%AB%E7%A0%81%E7%99%BB%E9%99%86" aria-hidden="true"><span class="octicon octicon-link"></span></a>电视端扫码登陆</h1>

<h3>
<a id="一电视端扫码登陆算法" class="anchor" href="#%E4%B8%80%E7%94%B5%E8%A7%86%E7%AB%AF%E6%89%AB%E7%A0%81%E7%99%BB%E9%99%86%E7%AE%97%E6%B3%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>一、电视端扫码登陆算法.</h3>

<h3>
<a id="二电视端扫码登陆程序流程图" class="anchor" href="#%E4%BA%8C%E7%94%B5%E8%A7%86%E7%AB%AF%E6%89%AB%E7%A0%81%E7%99%BB%E9%99%86%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE" aria-hidden="true"><span class="octicon octicon-link"></span></a>二、电视端扫码登陆程序流程图</h3>

<h1>
<a id="一电视端扫码登陆算法-1" class="anchor" href="#%E4%B8%80%E7%94%B5%E8%A7%86%E7%AB%AF%E6%89%AB%E7%A0%81%E7%99%BB%E9%99%86%E7%AE%97%E6%B3%95-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>一、电视端扫码登陆算法</h1>

<pre><code>1.电视端打开扫码页面，生成二维码并发送相应参数给服务器     
2.电视端开始轮询手机端是否已经扫描成功
3.电视端轮询手机端是否同意登录
4.电视端请求服务器获取用户登录所需的参数信息执行登陆
</code></pre>

<p>注：本算法基于长轮询</p>

<p>1、电视端打开扫码页面，生成二维码并发送相应参数给服务器 </p>

<pre><code>  1.1. 接口1：发送给服务器二维码信息
  1.2. 接口1提交服务器参数：
      (1) 电视端设备id(uuid)
      (2) 电视端类型（备课神器教师端：ROLE_LAOSHI，云课堂:ROLE_JIAZHANG）
      (3) 电视端二维码生成时间戳
  1.3. 接口1返回参数：
      (1) 操作成功失败标志：成功则转2，否则结束
</code></pre>

<p>注：服务器生成一条中间表记录（临时的）
2、电视端开始轮询手机端是否已经扫描成功            </p>

<pre><code>  A. 未扫：（中间表字段手机端设备id为空）
      (1) 已过期：电视端提示二维码失效 
      (2) 未过期：转 2
  B. 已扫
      (1) 已过期：（服务端通过时间戳+有效期共同决定，电视端具体操作暂定，电视端结束轮询），电视端做相应处理
      (2) 未过期：转 3
</code></pre>

<pre><code>  2.1.1. 接口2：电视端开始轮询手机端是否已经扫描成功
  2.1.2. 接口2提交服务器参数：
      (1) 电视端设备id（uuid）
  2.1.3. 服务器返回参数(可参考接口3所传参数)：
      (1) 过期标志
      (2) 是否已经扫描
      (3) 哪台手机扫的（手机设备id）

  2.2.1. 接口3：手机端扫码并发送相应参数给服务器
  2.2.2. 接口3提交服务器参数：
      (1) 手机端设备id
      (2) 客户端类型 (备课神器家长端，备课神器教师端)
      (3) 手机端扫描时间戳
      (4) 所扫描的电视端二维码对应的设备uuid
      (5) 用户名（yongHuMing）、密码（miMa） 、类型（leiXing），经纬度（jingDu，weiDu）
  2.2.3. 接口3返回参数：
      (1) 操作成功失败标志
</code></pre>

<p>注：若有其他手机扫过，则判断手机端设备id不为空，且不等于当前手机设备id，则提示“其他设备已扫描”（电视端生成的一个二维码只能有一个手机端可以去扫）</p>

<p>3、电视端轮询手机端是否同意登录</p>

<pre><code> A. 同意：
      (1) 已过期：电视端提示二维码失效 ,手机端此时扫描（请求服务器有关电视二维码的信息）应提示二维码过期
      (2) 未过期：电视端登陆，转 4
 B. 取消：
      (1) 手机端关闭确认登陆页面
      (2) 电视端回到初始页面
</code></pre>

<pre><code> 3.1.1. 接口4：电视端轮询手机端是否同意
 3.1.2. 接口4提交服务器参数：
      (1) 电视端设备id(uuid)
      (2) 手机端设备id
 3.2.1. 接口4返回参数：
      (1) 过期标志
      (2) 是否同意

 3.3.1. 接口5：手机端同意或取消接口 
 3.3.2. 接口5提交服务器参数:
      (1) 手机端设备id
      (2) 电视端设备id（好像重复了）
 3.3.3. 接口5返回参数:
      (1) 同意或取消标志
</code></pre>

<p>4、电视端请求服务器获取用户登录所需的参数信息执行登陆</p>

<pre><code>  4.1. 接口6：用户登录所需的参数信息
  4.2. 接口6提交服务器参数:
      (1) 手机端设备id
      (2) 电视端设备id 
  4.3. 接口6返回参数:
      (1) 用户登录所需的信息
</code></pre>

<p>注：</p>

<ol>
<li>轮询时间：3s ; 有效期:1min</li>
<li>二维码失效服务器端就删除此二维码</li>
<li>ROLE_JIAZHANG = 1;//家长角色
 ROLE_LAOSHI = 2;//教师长角色</li>
<li>中间表数据库字段：</li>
<li>
 (1) 电视端设备id(uuid)<br>
 (2) 电视端类型（备课神器教师端：ROLE_LAOSHI，云课堂:ROLE_JIAZHANG）<br>
 (3) 电视端二维码生成时间戳<br>
 (4) 手机端设备id<br>
 (5) 手机端类型 (备课神器家长端，备课神器教师端)<br>
 (6) 手机扫码时间戳<br>
 (7) 用户名（yongHuMing）<br>
 (8) 密码（miMa）<br> 
 (9) 类型（leiXing）<br>
 (10) 经度（jingDu<br>
 (11) 纬度（weiDu）<br>
 (12) 同意或取消<br>
</li>
<li>最新更正：时间戳统一以服务器为准。</li>
</ol>

<h1>
<a id="二电视端扫码登陆程序流程图-1" class="anchor" href="#%E4%BA%8C%E7%94%B5%E8%A7%86%E7%AB%AF%E6%89%AB%E7%A0%81%E7%99%BB%E9%99%86%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B%E5%9B%BE-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>二、电视端扫码登陆程序流程图</h1>

<p><img src="/images/%E7%94%B5%E8%A7%86%E7%AB%AF%E7%A0%81%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B.png" alt="电视端扫码登录流程图"></p>

<h1>
<a id="三附件" class="anchor" href="#%E4%B8%89%E9%99%84%E4%BB%B6" aria-hidden="true"><span class="octicon octicon-link"></span></a>三、附件</h1>

<p>另附：<a href="https://iloveaman.gitbooks.io/this-is-a-test-article/content/index.html">GitBook扫码登录</a></p>

      <footer class="site-footer">

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
